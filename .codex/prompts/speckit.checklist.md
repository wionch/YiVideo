---
description: 根据用户需求为当前功能生成自定义核查清单。
---

## 核查清单目的："需求单元测试"

**关键概念**：核查清单是**需求的单元测试**——它们验证给定领域中需求的质量、清晰度和完整性。

**不用于验证/测试**：

-   ❌ 不是“验证按钮点击正确”
-   ❌ 不是“测试错误处理工作”
-   ❌ 不是“确认 API 返回 200”
-   ❌ 不是检查代码/实现是否符合规范

**用于需求质量验证**：

-   ✅ “是否为所有卡片类型定义了视觉层次结构要求？”（完整性）
-   ✅ “‘显著显示’是否通过具体尺寸/定位进行了量化？”（清晰度）
-   ✅ “悬停状态要求在所有交互元素中是否一致？”（一致性）
-   ✅ “是否为键盘导航定义了可访问性要求？”（覆盖率）
-   ✅ “规范是否定义了徽标图像加载失败时发生的情况？”（边缘情况）

**隐喻**：如果你的规范是用英语编写的代码，那么核查清单就是它的单元测试套件。你在测试需求是否编写良好、完整、无歧义并准备好实施——而不是实施是否有效。

## 用户输入

```text
$ARGUMENTS
```

在继续之前（如果不为空），你**必须**考虑用户输入。

## 执行步骤

## MCP 使用要求 (必需)

-   生成核查清单前，默认按此顺序使用 MCP：
-   1. `sequential-thinking`：把用户输入信号（领域/风险/受众/深度）结构化成“检查维度”与“覆盖策略”，避免遗漏关键场景类别。
-   2. `serena`：只用于定位 spec/plan/tasks 中的相关段落、术语与 ID，以提升可追溯性引用密度（≥80% 规则不变）。
-   3. `context7`：当用户请求涉及行业标准/合规/安全/可访问性等“外部权威约束”时，用于获取可引用的基准（并在核查清单元信息中记录来源）。
-   若任一 MCP 不可用：必须在生成的核查清单文件头部增加一段“工具不可用说明”（缺失项、原因、替代来源、可能遗漏的维度）。

1. **设置**：从仓库根目录运行 `.specify/scripts/bash/check-prerequisites.sh --json` 并解析 FEATURE_DIR 和 AVAILABLE_DOCS 列表的 JSON。

    - 所有文件路径必须是绝对路径。
    - 对于像 "I'm Groot" 这样的参数中的单引号，请使用转义语法：例如 'I'\''m Groot'（或者如果可能的话使用双引号："I'm Groot"）。

2. **澄清意图（动态）**：推导最多三个初始上下文澄清问题（没有预先设定的目录）。它们必须：

    - 从用户的措辞 + 从 spec/plan/tasks 中提取的信号生成
    - 仅询问会实质性改变核查清单内容的信息
    - 如果在 `$ARGUMENTS` 中已经明确，则单独跳过
    - 偏好精确度胜过广度

    生成算法：

    1. 提取信号：功能领域关键字（例如，auth, latency, UX, API），风险指标（“critical”, “must”, “compliance”），利益相关者提示（“QA”, “review”, “security team”）和明确的可交付成果（“a11y”, “rollback”, “contracts”）。
    2. 将信号聚类为候选重点领域（最多 4 个），按相关性排名。
    3. 识别可能的受众和时间（作者、审阅者、QA、发布）（如果不明确）。
    4. 检测缺失的维度：范围广度、深度/严格度、风险重点、排除边界、可衡量的验收标准。
    5. 从这些原型中选择制定问题：
        - 范围细化（例如，“这应该包括与 X 和 Y 的集成接触点，还是仅限于本地模块的正确性？”）
        - 风险优先排序（例如，“这些潜在风险领域中的哪一个应该接受强制性门控检查？”）
        - 深度校准（例如，“这是一个轻量级的预提交健全性列表还是正式的发布门控？”）
        - 受众框架（例如，“这仅由作者使用还是由同行在 PR 审查期间使用？”）
        - 边界排除（例如，“我们在这一轮应该明确排除性能调优项目吗？”）
        - 场景类别缺口（例如，“未检测到恢复流程——回滚 / 部分故障路径是否在范围内？”）

    问题格式化规则：

    - 如果提供选项，生成一个紧凑的表格，包含列：选项 | 候选 | 为什么重要
    - 限制最多 A–E 选项；如果自由形式的答案更清晰，则省略表格
    - 永远不要要求用户重述他们已经说过的话
    - 避免推测性类别（无幻觉）。如果不确定，明确询问：“确认 X 是否属于范围内。”

    无法交互时的默认值：

    - 深度：标准
    - 受众：如果是代码相关的，则为审阅者 (PR)；否则为作者
    - 重点：前 2 个相关性集群

    输出问题（标签 Q1/Q2/Q3）。回答后：如果仍有 ≥2 个场景类别（替代 / 异常 / 恢复 / 非功能领域）不清楚，你可以再问最多两个针对性的后续问题 (Q4/Q5)，每个问题附带一句话的理由（例如，“未解决的恢复路径风险”）。总问题数不超过五个。如果用户明确拒绝更多，则跳过升级。

3. **理解用户请求**：结合 `$ARGUMENTS` + 澄清答案：

    - 推导核查清单主题（例如，security, review, deploy, ux）
    - 整合用户提到的明确必须包含的项目
    - 将重点选择映射到类别脚手架
    - 推断 spec/plan/tasks 中任何缺失的上下文（**不要**幻觉）

4. **加载功能上下文**：从 FEATURE_DIR 读取：

    - spec.md：功能需求和范围
    - plan.md（如果存在）：技术细节、依赖关系
    - tasks.md（如果存在）：实施任务

    **上下文加载策略**：

    - 仅加载与活动重点领域相关的必要部分（避免全文件转储）
    - 倾向于将长部分总结为简洁的场景/需求要点
    - 使用渐进式披露：仅在检测到缺口时添加后续检索
    - 如果源文档很大，生成临时摘要项目而不是嵌入原始文本

5. **生成核查清单** - 创建“需求单元测试”：

    - 如果不存在，创建 `FEATURE_DIR/checklists/` 目录
    - 生成唯一的核查清单文件名：
        - 使用基于领域的简短描述性名称（例如，`ux.md`, `api.md`, `security.md`）
        - 格式：`[domain].md`
        - 如果文件存在，追加到现有文件
    - 从 CHK001 开始按顺序编号项目
    - 每个 `/speckit.checklist` 运行都会创建一个新文件（从不覆盖现有核查清单）

    **核心原则 - 测试需求，而不是实现**：
    每个核查清单项目必须评估需求本身的：

    - **完整性**：所有必要的需求是否存在？
    - **清晰度**：需求是否明确且具体？
    - **一致性**：需求是否彼此一致？
    - **可衡量性**：需求是否可以客观验证？
    - **覆盖率**：是否解决了所有场景/边缘情况？

    **类别结构** - 按需求质量维度对项目进行分组：

    - **需求完整性**（所有必要的需求都记录了吗？）
    - **需求清晰度**（需求是否具体且无歧义？）
    - **需求一致性**（需求是否一致无冲突？）
    - **验收标准质量**（成功标准是否可衡量？）
    - **场景覆盖率**（所有流程/案例都解决了吗？）
    - **边缘情况覆盖率**（边界条件是否已定义？）
    - **非功能需求**（性能、安全性、可访问性等 - 它们是否已指定？）
    - **依赖关系和假设**（它们是否已记录并验证？）
    - **歧义和冲突**（什么需要澄清？）

    **如何编写核查清单项目 - “英语单元测试”**：

    ❌ **错误**（测试实现）：

    - “验证着陆页显示 3 个剧集卡片”
    - “测试桌面上的悬停状态是否有效”
    - “确认点击徽标导航到主页”

    ✅ **正确**（测试需求质量）：

    - “特色剧集的具体数量和布局是否已指定？”[完整性]
    - “‘显著显示’是否通过具体尺寸/定位进行了量化？”[清晰度]
    - “悬停状态要求在所有交互元素中是否一致？”[一致性]
    - “是否为所有交互式 UI 定义了键盘导航要求？”[覆盖率]
    - “规范是否定义了徽标图像加载失败时发生的情况？”[边缘情况]
    - “是否为异步剧集数据定义了加载状态？”[完整性]
    - “规范是否定义了竞争 UI 元素的视觉层次结构？”[清晰度]

    **项目结构**：
    每个项目应遵循此模式：

    - 询问有关需求质量的问题格式
    - 专注于 spec/plan 中写了什么（或没写什么）
    - 在括号中包含质量维度 [完整性/清晰度/一致性/等]
    - 检查现有需求时引用规范部分 `[Spec §X.Y]`
    - 检查缺失需求时使用 `[Gap]` 标记

    **按质量维度的示例**：

    完整性：

    - “是否为所有 API 故障模式定义了错误处理要求？[Gap]”
    - “是否为所有交互元素指定了可访问性要求？[完整性]”
    - “是否为响应式布局定义了移动断点要求？[Gap]”

    清晰度：

    - “‘快速加载’是否通过具体的时间阈值进行了量化？[清晰度, Spec §NFR-2]”
    - “‘相关剧集’的选择标准是否已明确定义？[清晰度, Spec §FR-5]”
    - “‘显著’是否通过可衡量的视觉属性进行了定义？[歧义, Spec §FR-4]”

    一致性：

    - “导航要求在所有页面上是否一致？[一致性, Spec §FR-10]”
    - “卡片组件要求在着陆页和详情页之间是否一致？[一致性]”

    覆盖率：

    - “是否定义了零状态场景（无剧集）的要求？[覆盖率, 边缘情况]”
    - “并发用户交互场景是否已解决？[覆盖率, Gap]”
    - “是否指定了部分数据加载失败的要求？[覆盖率, 异常流]”

    可衡量性：

    - “视觉层次结构要求是否可衡量/可测试？[验收标准, Spec §FR-1]”
    - “‘平衡的视觉权重’能否被客观验证？[可衡量性, Spec §FR-2]”

    **场景分类和覆盖率**（需求质量重点）：

    - 检查是否存在以下要求：主要、替代、异常/错误、恢复、非功能场景
    - 对于每个场景类，询问：“[场景类型] 需求是否完整、清晰且一致？”
    - 如果场景类缺失：“[场景类型] 需求是有意排除还是缺失？[Gap]”
    - 当发生状态突变时包括弹性/回滚：“是否定义了迁移失败的回滚要求？[Gap]”

    **可追溯性要求**：

    - 最低限度：≥80% 的项目必须包含至少一个可追溯性引用
    - 每个项目应引用：规范部分 `[Spec §X.Y]`，或使用标记：`[Gap]`, `[Ambiguity]`, `[Conflict]`, `[Assumption]`
    - 如果不存在 ID 系统：“是否建立了需求和验收标准 ID 方案？[可追溯性]”

    **表面和解决问题**（需求质量问题）：
    询问有关需求本身的问题：

    - 歧义：“术语‘快速’是否通过具体指标进行了量化？[歧义, Spec §NFR-1]”
    - 冲突：“导航要求在 §FR-10 和 §FR-10a 之间是否冲突？[冲突]”
    - 假设：“‘始终可用的播客 API’的假设是否已验证？[假设]”
    - 依赖关系：“外部播客 API 要求是否已记录？[依赖关系, Gap]”
    - 缺失定义：“‘视觉层次结构’是否通过可衡量标准进行了定义？[Gap]”

    **内容整合**：

    - 软上限：如果原始候选项目 > 40，按风险/影响优先排序
    - 合并检查相同需求方面的近似重复项
    - 如果 >5 个低影响边缘情况，创建一个项目：“需求中是否解决了边缘情况 X, Y, Z？[覆盖率]”

    **🚫 绝对禁止** - 这些使它成为实现测试，而不是需求测试：

    - ❌ 任何以“验证”、“测试”、“确认”、“检查” + 实现行为开头的项目
    - ❌ 引用代码执行、用户操作、系统行为
    - ❌ “显示正确”、“工作正常”、“按预期运行”
    - ❌ “点击”、“导航”、“渲染”、“加载”、“执行”
    - ❌ 测试用例、测试计划、QA 程序
    - ❌ 实现细节（框架、API、算法）

    **✅ 必需模式** - 这些测试需求质量：

    - ✅ “是否为 [场景] 定义/指定/记录了 [需求类型]？”
    - ✅ “[模糊术语] 是否通过具体标准进行了量化/澄清？”
    - ✅ “[部分 A] 和 [部分 B] 之间的需求是否一致？”
    - ✅ “[需求] 能否被客观衡量/验证？”
    - ✅ “需求中是否解决了 [边缘情况/场景]？”
    - ✅ “规范是否定义了 [缺失方面]？”

6. **结构参考**：按照 `.specify/templates/checklist-template.md` 中的规范模板生成核查清单，包括标题、元部分、类别标题和 ID 格式。如果模板不可用，请使用：H1 标题，目的/创建元行，包含 `- [ ] CHK### <需求项目>` 行的 `##` 类别部分，ID 从 CHK001 开始全局递增。

7. **报告**：输出已创建核查清单的完整路径、项目计数，并提醒用户每次运行都会创建一个新文件。总结：
    - 选定的重点领域
    - 深度级别
    - 参与者/时间
    - 包含的任何明确的用户指定必须拥有的项目

**重要**：每次 `/speckit.checklist` 命令调用都会使用简短的描述性名称创建核查清单文件，除非文件已存在。这允许：

-   不同类型的多个核查清单（例如，`ux.md`, `test.md`, `security.md`）
-   简单、易记的文件名，指示核查清单目的
-   在 `checklists/` 文件夹中轻松识别和导航

为避免混乱，请使用描述性类型并在完成后清理过时的核查清单。

## 示例核查清单类型和示例项目

**UX 需求质量：** `ux.md`

示例项目（测试需求，而不是实现）：

-   “视觉层次结构要求是否通过可衡量标准进行了定义？[清晰度, Spec §FR-1]”
-   “UI 元素的数量和位置是否已明确指定？[完整性, Spec §FR-1]”
-   “交互状态要求（悬停、焦点、活动）是否一致定义？[一致性]”
-   “是否为所有交互元素指定了可访问性要求？[覆盖率, Gap]”
-   “图像加载失败时是否定义了回退行为？[边缘情况, Gap]”
-   “‘显著显示’能否被客观衡量？[可衡量性, Spec §FR-4]”

**API 需求质量：** `api.md`

示例项目：

-   “是否为所有故障场景指定了错误响应格式？[完整性]”
-   “速率限制要求是否通过具体阈值进行了量化？[清晰度]”
-   “所有端点的认证要求是否一致？[一致性]”
-   “是否为外部依赖定义了重试/超时要求？[覆盖率, Gap]”
-   “需求中是否记录了版本控制策略？[Gap]”

**性能需求质量：** `performance.md`

示例项目：

-   “性能要求是否通过具体指标进行了量化？[清晰度]”
-   “是否为所有关键用户旅程定义了性能目标？[覆盖率]”
-   “不同负载条件下的性能要求是否已指定？[完整性]”
-   “性能要求能否被客观衡量？[可衡量性]”
-   “是否为高负载场景定义了降级要求？[边缘情况, Gap]”

**安全需求质量：** `security.md`

示例项目：

-   “是否为所有受保护资源指定了认证要求？[覆盖率]”
-   “是否为敏感信息定义了数据保护要求？[完整性]”
-   “威胁模型是否已记录且需求与其对齐？[可追溯性]”
-   “安全要求是否与合规义务一致？[一致性]”
-   “是否定义了安全故障/违规响应要求？[Gap, 异常流]”

## 反例：不要做什么

**❌ 错误 - 这些测试实现，而不是需求：**

```markdown
-   [ ] CHK001 - Verify landing page displays 3 episode cards [Spec §FR-001]
-   [ ] CHK002 - Test hover states work correctly on desktop [Spec §FR-003]
-   [ ] CHK003 - Confirm logo click navigates to home page [Spec §FR-010]
-   [ ] CHK004 - Check that related episodes section shows 3-5 items [Spec §FR-005]
```

**✅ 正确 - 这些测试需求质量：**

```markdown
-   [ ] CHK001 - Are the number and layout of featured episodes explicitly specified? [Completeness, Spec §FR-001]
-   [ ] CHK002 - Are hover state requirements consistently defined for all interactive elements? [Consistency, Spec §FR-003]
-   [ ] CHK003 - Are navigation requirements clear for all clickable brand elements? [Clarity, Spec §FR-010]
-   [ ] CHK004 - Is the selection criteria for related episodes documented? [Gap, Spec §FR-005]
-   [ ] CHK005 - Are loading state requirements defined for asynchronous episode data? [Gap]
-   [ ] CHK006 - Can "visual hierarchy" requirements be objectively measured? [Measurability, Spec §FR-001]
```

**关键区别：**

-   错误：测试系统是否正常工作
-   正确：测试需求是否编写正确
-   错误：行为验证
-   正确：需求质量验证
-   错误：“它做 X 吗？”
-   正确：“X 是否明确指定？”
